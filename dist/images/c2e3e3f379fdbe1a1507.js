import"../css/index.css";import{columns,tasks}from"./list";const modal=document.querySelector(".modal"),editModal=document.querySelector("#edit-modal"),editForm=document.querySelector("#edit-modal form"),newBoardModal=document.querySelector("#new-board"),newBoardForm=document.querySelector("#new-board form");function renderKanban(){const e=document.querySelector(".kanban");e.innerHTML="",columns.forEach((t=>{const n=document.createElement("section");n.className=`kanban__column kanban__column--${t.id}`,n.innerHTML=`\n      <div class="kanban__header">\n        <div class="kanban__header-content">\n          <img src="${t.icon}" alt="Колонка ${t.title}" class="kanban__icon kanban__icon--column">\n          <h2 class="kanban__title">${t.title}</h2>\n        </div>\n        ${"done"!==t.id?`<img src="${require("../../assets/img/kanban/plus.svg")}" alt="Добавить задачу" class="kanban__icon kanban__icon--add" data-column-id="${t.id}">`:""}\n      </div>\n      <div class="kanban__list"></div>\n    `;const a=n.querySelector(".kanban__list");t.tasks.forEach((e=>{const t=tasks.find((t=>t.id===e));t&&a.appendChild(renderTaskElement(t))})),e.appendChild(n)}))}function dragOnDrop(){const e=document.querySelectorAll(".task-item"),t=document.querySelectorAll(".kanban__column");e.forEach((e=>{e.addEventListener("dragstart",(()=>{e.classList.add("dragging")})),e.addEventListener("dragend",(()=>{e.classList.remove("dragging")}))})),t.forEach((e=>{e.addEventListener("dragover",(t=>{t.preventDefault();const n=document.querySelector(".dragging");e.querySelector(".kanban__list").appendChild(n)}))}))}function getComplexityClass(e){const t=new Date,n=new Date(e).getTime()-t.getTime(),a=Math.ceil(n/864e5);return a<=7?{tag:"complexity__dot--high",length:3}:a<=14?{tag:"complexity__dot--medium",length:2}:{tag:"complexity__dot--low",length:1}}function renderTaskElement(e){const t=document.createElement("div"),n=getComplexityClass(e.dueDate);t.className="task-item",t.setAttribute("draggable","true"),t.id=e.id;let a="";for(let e=0;e<n.length;e++)a+=`<span class="complexity__dot ${n.tag}"></span>`;return t.innerHTML=`\n    <h3 class="task-item__title">${e.title}</h3>\n    <p class="task-item__description">${e.description}</p>\n    <div class="task-item__info">\n      <div class="task-item__complexity complexity">\n        ${a}\n      </div>\n      <div class="task-item__client">${e.dueDate}</div>\n    </div>\n    <button class="task-item__edit-button">изменить</button>>\n  `,t}function editTask(e,t,n,a){let d=tasks.find((t=>t.id==e));d.title=t,d.description=n,d.dueDate=a,editForm.reset(),console.log(d)}function addNewBoard(e,t){let n={id:e,title:t,icon:require("../../assets/img/kanban/kanban__column--done.svg"),tasks:[]};columns.push(n)}document.addEventListener("DOMContentLoaded",(()=>{renderKanban(),dragOnDrop(),o();const e=document.querySelectorAll(".kanban__icon--add"),t=document.querySelector(".close-modal"),n=document.querySelector(".cancel-button"),a=document.querySelector(".modal form");let d=null;function o(){document.querySelectorAll(".kanban__icon--add").forEach((e=>{e.addEventListener("click",(()=>{d=e.getAttribute("data-column-id"),modal.style.display="flex"}))}))}e.forEach((e=>{e.addEventListener("click",(()=>{d=e.getAttribute("data-column-id"),modal.style.display="flex"}))})),a.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("title-task").value,n=document.getElementById("description-task").value,l=a.elements.date.value,i={id:tasks.length+1,title:t,description:n,dueDate:l,columnId:d};tasks.push(i);const s=columns.find((e=>e.id===i.columnId));s&&s.tasks.push(i.id),renderKanban(),dragOnDrop(),o(),a.reset(),modal.style.display="none"})),t.addEventListener("click",(()=>{modal.style.display="none"})),n.addEventListener("click",(()=>{modal.style.display="none"})),editForm.addEventListener("submit",(e=>{e.preventDefault(),editTask(editForm.getAttribute("data-task-id"),editForm.querySelector("#title-task").value,editForm.querySelector("#description-task").value,editForm.elements.date.value),renderKanban(),editModal.style.display="none"})),document.addEventListener("click",(e=>{if("task-item__edit-button"===e.target.className){let t=Number(e.target.closest(".task-item").id);editModal.style.display="flex";let n=tasks.find((e=>e.id===t));n&&(editForm.querySelector("#title-task").value=n.title,editForm.querySelector("#description-task").value=n.description,editForm.elements.date.value=n.dueDate,editForm.setAttribute("data-task-id",t.toString()))}"button--new-board"===e.target.className&&(newBoardModal.style.display="flex",newBoardForm.addEventListener("submit",(e=>{e.preventDefault(),addNewBoard(document.querySelector("#board-id").value,document.querySelector("#board-name").value),newBoardForm.reset(),newBoardModal.style.display="none",renderKanban(),o()})))}))}));